<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Attendance - Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <!-- QRCode will be loaded dynamically with multiple fallbacks inside admin.js -->
</head>
<body>
    <div class="container">
        <!-- Prominent Session Code Display -->
        <div id="session-code-banner" class="session-banner" style="display: none;">
            <div class="current-code-display">
                <div class="banner-header">
                    <h2>Current Session Code:</h2>
                    <div class="refresh-status" id="refresh-status">
                        <span class="refresh-indicator">ğŸ”„</span>
                        <span class="refresh-text">Auto-refreshing every 10s</span>
                    </div>
                </div>
                <div class="session-code-large" id="banner-session-code">No Active Session</div>
                <div class="next-rotation" id="banner-next-rotation"></div>
                <div class="next-rotation" id="slot-details" style="margin-top:6px; opacity:0.9;">
                    <span id="slot-index"></span>
                    <span> â€¢ </span>
                    <span id="slot-rotation"></span>
                    <span> â€¢ </span>
                    <span id="last-rendered"></span>
                </div>
            </div>
        </div>

        <header>
            <h1>ğŸ“ Admin Panel - Course Attendance</h1>
            <p>Manage sessions and view attendance records</p>
        </header>

        <!-- Session Management -->
        <div class="card">
            <h2>ğŸ“ Session Management</h2>
            
            <div class="form-group">
                <label for="course-name">Course Name:</label>
                <input type="text" id="course-name" placeholder="e.g., CS 101 - Introduction to Computer Science">
            </div>

            <div class="form-group">
                <label for="session-date">Session Date:</label>
                <input type="date" id="session-date">
            </div>

            <div class="button-group">
                <button id="generate-session-btn" class="btn btn-primary">ğŸ¯ Generate New Session</button>
                <button id="end-session-btn" class="btn btn-danger">â¹ï¸ End Current Session</button>
                <button id="setup-github-btn" class="btn btn-info">âš™ï¸ Setup GitHub Sync</button>
            </div>

            <div id="current-session" class="session-display">
                <h3>Current Session</h3>
                <div id="session-info">
                    <p>No active session</p>
                </div>
            </div>
        </div>

        <!-- QR Code Display -->
        <div id="qr-display" class="card" style="display: none;">
            <h2>ğŸ“± Student Check-In Access</h2>
            <div class="qr-container">
                <div style="text-align: center;">
                    <canvas id="qr-canvas" style="border: 2px solid #ddd; border-radius: 8px; margin-bottom: 10px;"></canvas>
                    <p style="color: #666; font-size: 12px; margin: 0;">QR-like visual pattern</p>
                </div>
                <div class="session-details">
                    <p><strong>Session Code (manual entry):</strong> <span id="display-session-code"></span></p>
                    <p><strong>Next Rotation:</strong> <span id="session-expiry"></span></p>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0; color: #2e7d32;">ğŸ“² For Students - Click this link:</h4>
                        <a id="student-link" href="#" target="_blank" rel="noopener" style="
                            display: block; 
                            background: #4CAF50; 
                            color: white; 
                            padding: 15px; 
                            text-decoration: none; 
                            border-radius: 6px; 
                            font-weight: bold;
                            text-align: center;
                            font-size: 16px;
                        ">ğŸ“± OPEN CHECK-IN PAGE</a>
                        <p style="margin: 10px 0 0 0; font-size: 12px; color: #555;">
                            Share this link via text message, email, or have students type the URL
                        </p>
                    </div>
                </div>
            </div>
            <div class="security-info">
                <h4>ğŸ”’ Security Features Active:</h4>
                <ul>
                    <li>ğŸ”„ <strong>Auto-Rotating:</strong> Code changes every 2 minutes</li>
                    <li>ğŸ“ <strong>Student ID Required:</strong> Official Student ID numbers for tracking</li>
                    <li>â° <strong>Minimum Stay:</strong> Students must wait 5 minutes before checking out</li>
                    <li>ğŸ¯ <strong>Real-time Validation:</strong> Screenshots won't work for check-out</li>
                </ul>
            </div>
            <p class="instruction"><strong>Display this screen in your classroom.</strong> Students cannot use screenshots to check out remotely.</p>
        </div>

        <!-- Live Attendance -->
        <div class="card">
            <h2>ğŸ‘¥ Live Attendance</h2>
            <div class="stats-row">
                <div class="stat-box">
                    <h3 id="total-checked-in">0</h3>
                    <p>Currently Present</p>
                </div>
                <div class="stat-box">
                    <h3 id="total-today">0</h3>
                    <p>Total Today</p>
                </div>
                <div class="stat-box">
                    <h3 id="session-duration">00:00</h3>
                    <p>Session Duration</p>
                </div>
            </div>
            
            <div id="live-attendance-list" class="attendance-list">
                <p>No students checked in yet</p>
            </div>

            <div class="button-group">
                <button id="refresh-btn" class="btn btn-outline">ğŸ”„ Refresh</button>
                <button id="manual-checkout-btn" class="btn btn-warning">ğŸ”“ Manual Check-out</button>
            </div>
            
            <div id="manual-checkout-form" class="manual-checkout" style="display: none;">
                <h4>Manual Student Check-out</h4>
                <p>Use this to check out students who forgot or had technical issues.</p>
                <div class="form-group">
                    <label for="checkout-student-id">Student Identifier:</label>
                    <input type="text" id="checkout-student-id" placeholder="Enter student identifier">
                </div>
                <div class="button-group">
                    <button id="confirm-manual-checkout" class="btn btn-danger">âœ… Confirm Check-out</button>
                    <button id="cancel-manual-checkout" class="btn btn-outline">âŒ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Attendance History -->
        <div class="card">
            <h2>ğŸ“ˆ Attendance History</h2>
            
            <div class="form-group">
                <label for="history-date">Select Date:</label>
                <input type="date" id="history-date">
                <button id="load-history-btn" class="btn btn-outline">ğŸ“Š Load History</button>
            </div>

            <div id="attendance-history">
                <p>Select a date to view attendance history</p>
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <h2>ğŸ’¾ Data Management</h2>
            
            <div class="button-group">
                <button id="export-btn" class="btn btn-success">ğŸ“¤ Export Data (CSV)</button>
                <button id="clear-data-btn" class="btn btn-warning">ğŸ—‘ï¸ Clear Old Data</button>
            </div>

            <div class="privacy-section">
                <h3>ğŸ”’ Privacy Settings</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="anonymous-mode">
                    Allow anonymous check-ins (students can use nicknames)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="auto-delete">
                    Auto-delete data after 90 days
                </label>
            </div>
        </div>

        <footer>
            <p>ğŸ”’ Privacy Protected | âš¡ Zero Cost Solution</p>
            <a href="index.html" class="admin-link">â† Back to Student Interface</a>
        </footer>
    </div>

    <!-- GitHub Setup Modal -->
    <div id="github-setup-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; margin: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <h3 style="margin: 0 0 20px 0; color: #333;">ğŸ”§ GitHub Sync Setup</h3>
            <p style="margin-bottom: 20px; color: #666;">To enable real-time attendance sync across devices, enter your GitHub Personal Access Token:</p>
            
            <div style="margin: 20px 0;">
                <label for="github-token" style="display: block; margin-bottom: 5px; font-weight: bold;">GitHub Token:</label>
                <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                    <strong>Need a token?</strong><br>
                    1. Go to GitHub.com â†’ Settings â†’ Developer settings<br>
                    2. Personal access tokens â†’ Tokens (classic)<br>
                    3. Generate new token with <strong>"repo"</strong> permissions
                </div>
            </div>
            
            <div id="github-status" style="margin: 15px 0; padding: 10px; border-radius: 4px; display: none;"></div>
            
            <div style="text-align: right; margin-top: 20px;">
                <button id="cancel-github-setup" class="btn btn-secondary" style="margin-right: 10px;">Cancel</button>
                <button id="save-github-setup" class="btn btn-primary">Save & Test</button>
            </div>
        </div>
    </div>

    <!-- Local QR Code library (no external dependencies) -->
    <script src="qrcode-lib.js?v=2025012809"></script>
    <!-- GitHub-based storage for cross-device sync -->
    <script src="github-storage.js?v=2025012809"></script>
    <script src="admin.js?v=2025012809"></script>
</body>
</html>
